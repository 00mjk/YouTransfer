{% extends "layout.html" %}

{#############################################################################################}
{# This is a workaround because Nunjucks does not support complex value-based if expressions #}
{#############################################################################################}

{% if security.accessRights == 'restricted' %}
	{% if user and user.status == 'allowed' %}
		{% set authorized = "true" %}
	{% endif %}
{% else %}
	{% set authorized = "true" %}
{% endif %}

{% block content %}
<div class="hp jumbotron" id="hp">
	{% include "title.html" %}
	
	{% if not authorized %}

		{% include "login.html" %}

	{% else %}

		<div class="{{ "col-md-6" if isPostback or general.enableDownload else "col-md-12" }} dz-upload-container">
			{%if isPostback %}

				{% if success %}

					{% import "dropzone.html" as dropzone %}
					{{ dropzone.preview(bundle, isPostback)}}

				{% else %}

					{% import "errors.html" as err %}
					{{ err.show(errors) }}
					<a href="/" data-async data-target="hp">Return to homepage</a>

				{% endif %}

			{% elif authorized %}

				{% include "fileupload.html" %}

			{% else %}

				<p>Some nice text that will tell you that you have to wait for approval2</p>

			{% endif %}
		</div>

		{% if success and authorized %}
		<div class="col-md-6 dz-completed-container">

			{%if isPostback %}

				{% include "sendmail.html" %}

			{% elif general.enableDownload %}

			<div class="separator text-center">
				<h6 class="separator-text"><em>or</em></h6>
				<hr class="separator-ruler visible-xs-block visible-sm-block" />
			</div>

			{% include "gettoken.html" %}

			{% endif %}
		</div>
		{% endif %}

	{% endif %}
</div>
{% endblock %}
